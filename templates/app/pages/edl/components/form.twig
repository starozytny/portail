{% set isDefined = edl is defined %}

<form class="edl-form" data-from="{{ from }}" data-id="{{ isDefined ? edl.inventory.id : "" }}" data-url="{{ url_edl_form }}" method="POST">
    <div class="error-form">
        <div class="alert alert-danger">
            <span class="icon-warning"></span>
            <p></p>
        </div>
    </div>
    <div class="line line-3">
        {% include 'app/layout/components/form/select.twig' with {
            input_name: 'attribution',
            input_label: 'Attribution',
            input_value: isDefined ? edl.inventory.user_id : session.user[7],
            input_required: true,
            input_choices: users
        } %} {# var users come from controller #}

        {% if models | length > 0 %}
            {% set structures = [
                {value: 0, label: 'EDL vierge'},
                {value: 1, label: 'Etablir structure'},
                {value: 2, label: 'EDL précédent'}
            ] %}
        {% else %}
            {% set structures = [
                {value: 0, label: 'EDL vierge'},
                {value: 2, label: 'EDL précédent'}
            ] %}
        {% endif %}

        {% include 'app/layout/components/form/select.twig' with {
            input_name: 'structure',
            input_label: 'Structure',
            input_value: isDefined and edl.inventory.input != 0 ? (edl.inventory.input < 0 ? 1 : 2) : 0,
            input_required: true,
            input_choices: structures
        } %}

        {% include 'app/layout/components/form/input.twig' with {
            input_name: 'startDate',
            input_label: 'Prévu le (facultatif)',
            input_value: isDefined and edl.inventory.date != "0" ? edl.inventory.date | date('Y-m-d\\TH:i') : '',
            input_type: 'datetime-local'
        } %}
    </div>
    <div class="line line-3">
        {% include 'app/layout/components/form/box.twig' with {
            input_name: 'type',
            input_label: 'Type d\'état des lieux',
            input_value: isDefined ? edl.inventory.type : 1,
            input_choices: [
                {value: 1, label: 'Entrant', name: 'entrant'},
                {value: 0, label: 'Sortant', name: 'sortant'},
            ],
            input_class: 'radiobox-item',
            input_type: 'radio'
        } %}

        {% include 'app/layout/components/form/select.twig' with {
            input_name: 'model',
            input_label: 'Modèle',
            input_value: isDefined and edl.inventory.input != 0 ? edl.inventory.input : "",
            input_choices: models,
            input_void: true
        } %} {# var models come from controller #}

        <div class="form-group"></div>
    </div>

    <div class="line line-select-or-add">
        <div class="form-group input-bien">
            <label>Bien</label>
            {% include 'app/layout/components/form/input_error.twig' with {
                msg: "Veuillez sélectionner ou ajouter un bien."
            } %}
        </div>
        <div class="actions-bien select-or-add {{ isDefined ? "" : "active" }}">
            <div class="btn btn-outline-default btn-select-bien">Sélectionner un bien</div>
            <div class="btn btn-outline-default btn-add-bien">Ajouter un bien</div>
        </div>
        <div class="selected selected-bien {{ isDefined ? "active" : "" }}">
            <div class="card active">
                <div class="btn-remove">
                    <div class="from"></div>
                    <div class="btn-icon btn-remove-bien">
                        <span class="icon-cancel"></span>
                        <div class="tooltip">Déselectionner ce bien</div>
                    </div>
                </div>
                <div class="card-header">
                    <div class="title">
                        <div class="label">
                            <div class="name">
                                <div class="adr bold">{{ isDefined ? edl.property.addr1 : "" }}</div>
                                <div class="adr2">{{ isDefined ? edl.property.addr2 : "" }}</div>
                                <div class="adr3">{{ isDefined ? edl.property.addr3 : "" }}</div>
                            </div>
                            <div class="sub">
                                <span class="zipcode">{{ isDefined ? edl.property.zipcode : "" }}</span>,
                                <span class="city">{{ isDefined ? edl.property.city : "" }}</span>
                            </div>
                        </div>
                        <div>Ref : <span class="ref">{{ isDefined ? edl.property.reference : "" }}</span></div>
                    </div>
                </div>
                <div class="card-body">
                        <div class="building sub details">
                            {% if edl.property.building %}
                                Bâtiment : {{ edl.property.building }}
                            {% endif %}
                        </div>
                        <div class="typeBien sub details">
                            {% if edl.property.type %}
                                Type : {{ edl.property.type }}
                            {% endif %}
                        </div>
                        <div class="owner sub details">{{ edl.property.owner != "" ? "Propriétaire : " ~ edl.property.owner : "Pas de propriétaire renseigné" }}</div>
                        <div class="surface sub details">
                            {% if edl.property.surface > "0" %}
                                {{ edl.property.surface }}m²
                            {% endif %}
                        </div>
                        <div class="room sub details">
                            {% if edl.property.room %}
                                {{ edl.property.room }} {{ edl.property.room > 1 ? "pièces" : "piece" }}
                            {% endif %}
                        </div>
                        <div class="floor sub details">
                            {% if edl.property.floor != "0" %}
                                {{ edl.property.floor }} {{ edl.property.floor > 1 ? "ème étage" : "er étage" }}
                            {% endif %}
                        </div>
                        <div class="door sub details">
                            {% if edl.property.door %}
                                Porte : {{ edl.property.door }}
                            {% endif %}
                        </div>
                        <div class="is_furnished sub details">
                            {% if edl.property.is_furnished %}
                                Meublé
                            {% endif %}
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div class="line line-select-or-add">
        <div class="form-group input-tenants">
            <label>Locataire(s)</label>
            {% include 'app/layout/components/form/input_error.twig' with {
                msg: "Veuillez sélectionner ou ajouter un locataire."
            } %}
        </div>
        <div class="actions-tenants select-or-add active">
            <div class="btn btn-outline-default btn-select-tenants">Sélectionner un/des locataire(s)</div>
            <div class="btn btn-outline-default btn-add-tenant">Ajouter un/des locataire(s)</div>
        </div>
        <div class="selected selected-tenants"></div>
    </div>

    <input type="hidden" name="bien" id="bien" value="{{ isDefined ? edl.property.id }}">
    <input type="hidden" name="tenants" id="tenants" value="">
    <input type="hidden" name="bien-created" id="bien-created" value="">
    <input type="hidden" name="tenants-created" id="tenants-created" value="">

    <div class="form-button">
        <button type="submit" class="btn btn-{{ from == "create" ? "primary" : "warning" }}">{{ from == "create" ? "Ajouter" : "Modifier" }} l'état des lieux</button>
    </div>
</form>